<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		
		<script type="text/javascript" src="three.min.js"></script>
    	<script type="text/javascript" src="roslib.js"></script>
    	<script type="text/javascript" src="ros3d.js"></script>
    	<script type="text/javascript" src="ColladaLoader.min.js"></script>
    	<script type="text/javascript" src="ColladaLoader2.min.js"></script>
    	<script type="text/javascript" src="STLLoader.min.js"></script>
    	<script type="text/javascript" src="eventemitter2.min.js"></script>
    	<script type="text/javascript" src="virtualjoystick.js"></script>
    	<script type="text/javascript" src="control.js"></script>
    	<script type="text/javascript">
   function init() {
      function waitForDOM() {
	  var video = document.getElementById('videoCanvas');
	  var basePad = document.getElementById('baseContainer');
          if (video == null || basePad == null) {
	      setTimeout(waitForDOM, 100);
          }
      }
       waitForDOM();
   }
   </script> 
	</head>
	<body >
		<table width="100%" border="0" cellpadding="0" cellspacing="0" style="margin-top:10px;">
  <tr>
    <td style="vertical-align:top;">
      <!-- *** Left-Top Panel: Connect/Disconnect to the rosbridge Server -->
      <table border="0" cellpadding="0" cellspacing="0">
    <tr>
      <td style="vertical-align:top;">
        <div style="text-align:center;margin-left:10px;margin-top:0px;">
          Server Hostname or IP: <input type="text" id="rosbridgeHost" value="">&nbsp;
          Port: <input type="text" id="rosbridgePort" value="" size="5">&nbsp;
          <input id="connectButton" type="button" width="50" value="Disconnect"></div>
      </td>
    </tr>

    <!-- *** Left-Bottom Panel: Video Display -->
    <tr>
      <td style="vertical-align:top;">
        <!-- Display the mjpeg video canvas -->
        <!--div id="videoMessages" style="height:35px; margin-left:40px;"></div-->
        <div id="map" style="text-align:center; margin-left:15px; position:relative; display:block;"></div>
      </td>
    </tr>
    </table>
      </td>
      
      <!-- Right Panel: Base control and speed settings -->
      <td style="vertical-align:top;text-align:center;">

    <fieldset><legend>Base Control</legend>
          <div id="baseMessages" style="height:35px;"></div>
          <div id="container"></div>
    </fieldset>

    <fieldset><!-- <legend>Base Max Speed</legend> -->
          <table border="0" cellpadding="0" cellspacing="0" style="width:100%; vertical-align:top; text-align:center;">
            <tr>
          <td align="right">Max Linear Spd: </td>
          <td><input id="maxLinearSpeed" min="0.01" max="0.5" step="0.01" value="0.12" onChange="maxLinearSpeedDisplay.value=this.value;setMaxLinearSpeed(this.value);" onInput="maxLinearSpeedDisplay.value=this.value;setMaxLinearSpeed(this.value);" type="range">&nbsp;<output id="maxLinearSpeedDisplay">0.18</output></td>
            </tr>
            <tr>
          <td align="right">Max Rotation Spd: </td>
          <td><input id="maxAngularSpeed" min="0.1" max="0.4" step="0.01" value="0.2" onChange="maxAngularSpeedDisplay.value=this.value;setMaxAngularSpeed(this.value);" onInput="maxAngularSpeedDisplay.value=this.value;setMaxAngularSpeed(this.value);" type="range">&nbsp;<output id="maxAngularSpeedDisplay">1.2</output></td>
            </tr>
          </table>
    </fieldset>

        <!-- Battery and servo status -->
    <fieldset><!-- <legend>Robot Status</legend> -->
      <table border="0" cellpadding="0" cellspacing="0" style="width:100%; vertical-align:top; text-align:center;">
          <tr>
        <td style="text-align:right;vertical-align:top;">
          <span id="robotBatteryGauge"></span>
          <span id="robotReharging">&nbsp;</span>
        </td>
        <td style="font-size:14pt;text-align:left;">Robot Battery</td>
              </tr>
          
          </table>
    </fieldset>

<!--
    <fieldset><legend>Head Pan/Tilt</legend>
      <table style="border:0pt none ; text-align:left; margin-left:auto; margin-right:auto;">
            <tbody>
              <tr>
          <tr>
        <td valign="top" style="text-align:center;"><span style="font-weight:bold;">Pan: <output id="panSliderSisplay">0.0</output></span></td>
        <td colspan="3" valign="top"><input id="panSlider" min="-3.0" max="3.0" step="0.05" value="0.0" onChange="panSliderDisplay.value=this.value;setPan(this.value);" type="range"><p></td>
              </tr>
          <tr>
        <td style="text-align:center;"><input class="centerServos" value="Center" onclick="centerHeadServos();" type="button"></td>
        <td><input class="relaxServos" value="Relax" onclick="relaxAllServos();" type="button"></td>
        <td><input class="driveView" value="Drive View" onclick="drivePanTilt();" type="button"></td>
              </tr>
          </tbody></table>
    </fieldset>
-->
      </td>
    </tr>

</table>
		
		

		<script>
			//console.log("touchscreen is", VirtualJoystick.touchScreenAvailable() ? "available" : "not available");
	
			var joystick	= new VirtualJoystick({
				container	: document.getElementById('container'),
				mouseSupport	: true,
			});			joystick.addEventListener('touchStart', function(){
				console.log('down')
			})
			joystick.addEventListener('touchEnd', function(){
				console.log('up')
			})

			setInterval(function(){
	
			    var rad = Math.atan2(joystick.deltaY(), joystick.deltaX());
			    move(-joystick.deltaY()/100,-joystick.deltaX()/100);
				var outputEl	= document.getElementById('result');
				outputEl.innerHTML	= '<b>Result:</b> '
					+ ' dx:'+joystick.deltaX()
					+ ' dy:'+joystick.deltaY()
					+ (joystick.right()	? ' right'	: '')
					+ (joystick.up()	? ' up'		: '')
					+ (joystick.left()	? ' left'	: '')
					+ (joystick.down()	? ' down' 	: '')	
			}, 1/30 * 1000);
		</script>
	</body>
</html>
